(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7411],{87686:function(e,t,s){Promise.resolve().then(s.bind(s,97867)),Promise.resolve().then(s.bind(s,31085)),Promise.resolve().then(s.bind(s,3399))},3399:function(e,t,s){"use strict";s.d(t,{default:function(){return T}});var l=s(57437),a=s(80670),n=s(75060),r=s(23675),i=s(2265),d=s(29501),o=s(91964),c=s(23340),x=s(31229),m=s(13590),u=s(21770);s(83079);var h=(0,s(12119).$)("eec3039f4c32da09bdb5db659e9882031a7f80ff"),p=s(86700),j=s(12381),f=s(42586),b=s(29827),v=e=>{let{selectedMethod:t,setSelectedMethod:s,onSubmit:a,cartData:n}=e,r=(0,f.useTranslations)(),i=(0,b.NL)().getQueryData(["voucherData"]),d=(null==i?void 0:i.discount)||0,o=(null==i?void 0:i.total)||(null==n?void 0:n.total),c=(null==i?void 0:i.sub_total)||(null==n?void 0:n.total),x=[{key:"credit",label:r("credit")},{key:"cash",label:r("cash")},{key:"wallet",label:r("wallet")},{key:"apple",label:r("apple")},{key:"mada",label:r("mada")}];return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"px-[20px] py-[16px] border border-text-borders rounded-sm mb-3 ",children:[(0,l.jsxs)("h2",{className:" text-[18px] font-bold text-text-main ",children:[" ",r("Shopping-cart")," "]}),(0,l.jsxs)("div",{className:"flex flex-col gap-y-[14px] ",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center py-[12px] border-b border-text-borders ",children:[(0,l.jsx)("span",{className:"text-[16px] font-normal text-text-sub ",children:r("Subtotal")}),(0,l.jsxs)("span",{className:"text-[14px] font-normal text-text-main ",children:[c," ",r("Saudi-Riyal")]})]}),d>0&&(0,l.jsxs)("div",{className:"flex justify-between items-center py-[12px] border-b border-text-borders",children:[(0,l.jsx)("span",{className:"text-[16px] font-normal text-text-sub",children:r("opponent")}),(0,l.jsxs)("span",{className:"text-[14px] font-normal text-accent-danger",children:["-",d," ",r("Saudi-Riyal")]})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center py-[12px] border-b border-text-borders ",children:[(0,l.jsx)("span",{className:"text-[16px] font-normal text-text-sub ",children:r("total")}),(0,l.jsxs)("span",{className:"text-[16px] font-bold text-text-main ",children:[o," ",r("Saudi-Riyal")]})]})]})]}),(0,l.jsxs)("div",{className:"px-[20px] py-[16px] border border-text-borders rounded-sm",children:[(0,l.jsx)("h2",{className:"text-[18px] font-bold text-text-main mb-[14px] ",children:r("payment-method")}),(0,l.jsx)(p.E,{value:t,onValueChange:e=>s(e),className:"flex flex-col items-end gap-y-[16px]",children:x.map(e=>{let{key:t,label:s}=e;return(0,l.jsx)("div",{className:"flex",children:(0,l.jsxs)("label",{className:"flex items-center justify-end gap-2",children:[(0,l.jsx)("span",{className:"text-[16px] font-normal text-text-sub",children:s}),(0,l.jsx)(p.m,{value:t})]})},t)})}),(0,l.jsxs)(j.z,{variant:"default",className:"w-full mt-[14px] ",onClick:a,children:[" ",r("Order-now")," "]})]})]})},g=s(74291),y=s(40279),N=s(17384),w=s(15291),_=s(16593),S=e=>{let{control:t}=e,s=(0,f.useTranslations)(),{data:r}=(0,_.a)({queryKey:["cities"],queryFn:async()=>{let e=await fetch("".concat("http://localhost:3000","/api/cities"));return await e.json()}});return(0,l.jsx)(a.Wi,{name:"city_id",control:t,render:e=>{var t;let{field:i}=e;return(0,l.jsxs)(a.xJ,{children:[(0,l.jsxs)(n._,{htmlFor:"city_id",children:[" ",s("country")," "]}),(0,l.jsxs)(w.Ph,{name:"city_id",value:i.value,onValueChange:i.onChange,children:[(0,l.jsx)(w.i4,{children:(0,l.jsx)(w.ki,{placeholder:s("country")})}),(0,l.jsx)(w.Bw,{children:null==r?void 0:null===(t=r.data)||void 0===t?void 0:t.map(e=>(0,l.jsx)(w.Ql,{value:e.id.toString(),children:e.title},e.id))})]}),(0,l.jsx)(a.zG,{})]})}})},z=e=>{let{control:t}=e,s=(0,f.useTranslations)(),{data:r}=(0,_.a)({queryKey:["areas"],queryFn:async()=>{let e=await fetch("".concat("http://localhost:3000","/api/areas"));return await e.json()}});return(0,l.jsx)(a.Wi,{name:"area_id",control:t,render:e=>{var t;let{field:i}=e;return(0,l.jsxs)(a.xJ,{children:[(0,l.jsxs)(n._,{htmlFor:"area_id",children:[" ",s("city")," "]}),(0,l.jsxs)(w.Ph,{name:"area_id",value:i.value,onValueChange:i.onChange,children:[(0,l.jsx)(w.i4,{children:(0,l.jsx)(w.ki,{placeholder:s("city")})}),(0,l.jsx)(w.Bw,{children:null==r?void 0:null===(t=r.data)||void 0===t?void 0:t.map(e=>(0,l.jsx)(w.Ql,{value:e.id.toString(),children:e.title},e.id))})]}),(0,l.jsx)(a.zG,{})]})}})},C=()=>{let e=(0,f.useTranslations)(),{isLoaded:t}=(0,o.Db)({googleMapsApiKey:"AIzaSyARi2_ixsNJLHYvTuUFZfKQDDagjy-Z2C0"}),{toast:s}=(0,c.pm)(),{mutateAsync:r}=(0,u.D)({mutationFn:e=>(0,N.tV)(e)}),h=x.z.object({title:x.z.string().min(1,e("title_required")),street:x.z.string().min(1,e("street_required")),city_id:x.z.string().min(1,e("city_id_required")),area_id:x.z.string().min(1,e("area_id_required")),house_number:x.z.string().min(1,e("house_number_required")),lat:x.z.string().optional(),lng:x.z.string().optional(),address:x.z.string().optional()}),p=(0,d.cI)({defaultValues:{title:"",street:"",house_number:"",city_id:"",area_id:"",lat:"",lng:"",address:""},resolver:(0,m.F)(h)}),[b,v]=(0,i.useState)(null),w=async e=>{if(e.latLng){let t=e.latLng.lat(),s=e.latLng.lng();v({lat:t,lng:s}),p.setValue("lat",t.toString()),p.setValue("lng",s.toString());try{let e=await fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(t,"&lon=").concat(s)),l=await e.json();l&&l.display_name?p.setValue("address",l.display_name):console.error("لم يتم العثور على عنوان.")}catch(e){console.error("خطأ أثناء جلب العنوان:",e)}}},_=async t=>{let l=await r(t);200===l.status?s({title:e("success_title"),description:e("success_description"),variant:"default"}):s({title:e("error_title"),description:(null==l?void 0:l.message)||e("error_description"),variant:"destructive"})};return(0,l.jsxs)(g.Dialog,{children:[(0,l.jsx)(g.DialogTrigger,{asChild:!0,children:(0,l.jsx)(j.z,{variant:"transparent",className:"md:w-1/2 w-full ",children:e("add_address_button")})}),(0,l.jsxs)(g.DialogContent,{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto bg-white rounded-md shadow-md p-6",children:[(0,l.jsx)(g.fK,{className:"mt-4",children:(0,l.jsx)(g.$N,{className:"text-lg font-bold text-gray-800 rtl:text-right",children:e("choose_location_title")})}),(0,l.jsx)(a.l0,{...p,children:(0,l.jsx)("form",{onSubmit:p.handleSubmit(_),children:(0,l.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,l.jsx)(a.Wi,{name:"title",control:p.control,render:t=>{let{field:s}=t;return(0,l.jsxs)(a.xJ,{children:[(0,l.jsx)(n._,{children:e("name_label")}),(0,l.jsx)(y.I,{...s,placeholder:e("name_placeholder")}),(0,l.jsx)(a.zG,{})]})}}),(0,l.jsxs)("div",{className:" block md:flex items-center  gap-x-[12px] ",children:[(0,l.jsx)("div",{className:" w-full md:w-1/2  my-[10px] md:my-0 ",children:(0,l.jsx)(S,{control:p.control})}),(0,l.jsx)("div",{className:" w-full md:w-1/2",children:(0,l.jsx)(z,{control:p.control})})]}),(0,l.jsxs)("div",{className:" block md:flex items-center  gap-x-[12px] ",children:[(0,l.jsx)("div",{className:" w-full md:w-1/2  my-[10px] md:my-0 ",children:(0,l.jsx)(a.Wi,{name:"street",control:p.control,render:t=>{let{field:s}=t;return(0,l.jsxs)(a.xJ,{children:[(0,l.jsx)(n._,{children:e("street_label")}),(0,l.jsx)(y.I,{...s,placeholder:e("street_label")}),(0,l.jsx)(a.zG,{})]})}})}),(0,l.jsx)("div",{className:" w-full md:w-1/2",children:(0,l.jsx)(a.Wi,{name:"house_number",control:p.control,render:t=>{let{field:s}=t;return(0,l.jsxs)(a.xJ,{children:[(0,l.jsxs)(n._,{children:[" ",e("house_number_label")," "]}),(0,l.jsx)(y.I,{...s,placeholder:e("house_number_label")}),(0,l.jsx)(a.zG,{})]})}})})]}),(0,l.jsx)("div",{className:"w-full h-[300px] my-4",children:(0,l.jsx)(o.b6,{mapContainerStyle:{width:"100%",height:"100%"},center:b||{lat:30.0444,lng:31.2357},zoom:10,onClick:w,children:b&&(0,l.jsx)(o.Jx,{position:b})})}),(0,l.jsx)(g.DialogTrigger,{children:(0,l.jsx)(j.z,{type:"submit",className:"w-full mt-4",children:e("save_location_button")})})]})})})]})]})};let k=e=>{let{locations:t,setAddressId:s}=e,a=(0,f.useTranslations)(),[n,r]=(0,i.useState)(null),[d]=(0,i.useState)(t),[c,x]=(0,i.useState)(!1),m=e=>{r(e),s(e),x(!1)};return(0,l.jsxs)(g.Dialog,{open:c,onOpenChange:x,children:[(0,l.jsx)(g.DialogTrigger,{asChild:!0,children:(0,l.jsxs)("div",{className:"flex items-center gap-x-[8px] md:text-[1rem] text-[0.8rem] font-bold text-normal cursor-pointer",onClick:()=>x(!0),children:[a("Select-locations"),(0,l.jsx)("img",{src:"/assets/icons/location-tick.svg",alt:"icon"})]})}),(0,l.jsxs)(g.DialogContent,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto bg-white rounded-md shadow-md p-6",children:[(0,l.jsx)(g.fK,{className:"mt-4",children:(0,l.jsx)(g.$N,{className:"text-lg font-bold text-gray-800 rtl:text-right",children:a("Select-locations")})}),(0,l.jsx)("div",{children:(0,l.jsx)(p.E,{value:null==n?void 0:n.toString(),onValueChange:e=>m(Number(e)),className:"flex flex-wrap items-center justify-end gap-0 ",children:d.map(e=>(0,l.jsx)("div",{className:"md:w-4/12 w-full my-5 md:my-2",children:(0,l.jsx)("div",{className:"px-4",children:(0,l.jsxs)("div",{className:"p-[12px] rounded-sm border relative cursor-pointer transition-all ".concat(n===e.id?"border-normal shadow-md":"border-text-borders"),onClick:()=>m(e.id),children:[(0,l.jsx)(p.m,{value:e.id.toString(),id:"location-".concat(e.id),className:"cursor-pointer"}),(0,l.jsx)(o.b6,{mapContainerStyle:{width:"100%",height:"210px"},center:{lat:parseFloat(e.lat),lng:parseFloat(e.lng)},zoom:9,children:(0,l.jsx)(o.Jx,{position:{lat:parseFloat(e.lat),lng:parseFloat(e.lng)}},"".concat(e.id,"-").concat(e.lat,"-").concat(e.lng))}),(0,l.jsxs)("div",{className:"flex flex-col gap-y-[16px] pt-[16px]",children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-[8px]",children:[(0,l.jsx)("img",{src:"/assets/icons/location2.svg",alt:"icon"}),(0,l.jsx)("span",{className:"text-[1rem] text-text-main font-normal",children:e.address})]}),(0,l.jsx)("div",{children:(0,l.jsxs)("h3",{className:"text-[1.1rem] text-text-main font-bold",children:[e.area," - ",e.city]})}),(0,l.jsx)("div",{children:(0,l.jsxs)("p",{className:"text-[1rem] text-text-sub font-normal",children:[e.house_number,", ",e.street]})})]})]})})},e.id))})}),(0,l.jsxs)("div",{className:"block md:flex items-center justify-between w-full gap-x-8",children:[(0,l.jsx)(j.z,{className:"md:w-1/2 w-full mb-5 md:mb-0",variant:"default",onClick:()=>null!==n&&x(!1),children:a("Specify-address")}),(0,l.jsx)(C,{})]})]})]})};var D=s(8878);let F=e=>{let{open:t,onOpenChange:s}=e,a=(0,f.useTranslations)();return(0,l.jsx)(g.Dialog,{open:t,onOpenChange:s,children:(0,l.jsxs)(g.DialogContent,{className:"w-full max-w-xl bg-white rounded-md shadow-md p-6",children:[(0,l.jsxs)("div",{className:"flex flex-col justify-center items-center",children:[(0,l.jsx)("h3",{className:"text-[32px] font-bold text-text-main",children:a("order_success_title")}),(0,l.jsx)("div",{className:"py-[20px]",children:(0,l.jsx)("p",{className:"text-[20px] font-normal text-text-sub text-center",children:a("order_success_description")})})]}),(0,l.jsxs)("div",{className:"block md:flex items-center justify-between w-full gap-x-[32px]",children:[(0,l.jsx)(D.rU,{href:"/",className:"w-full",children:(0,l.jsx)(j.z,{className:"w-full md:mb-0 mb-5",variant:"default",onClick:()=>s(!1),children:a("view_my_orders")})}),(0,l.jsx)(D.rU,{href:"/",className:"w-full",children:(0,l.jsx)(j.z,{className:"w-full",variant:"transparent",onClick:()=>s(!1),children:a("go_to_homepage")})})]})]})})};var T=e=>{let{locations:t,cartData:s}=e,p=(0,f.useTranslations)(),{isLoaded:j}=(0,o.Db)({googleMapsApiKey:"AIzaSyARi2_ixsNJLHYvTuUFZfKQDDagjy-Z2C0"}),[b,g]=(0,i.useState)(null),[y,N]=(0,i.useState)("cash"),[w,_]=(0,i.useState)(!1),{toast:S}=(0,c.pm)(),z=x.z.object({payment_method:x.z.string().optional(),notes:x.z.string().optional(),address_id:x.z.number().optional()}),C=(0,d.cI)({defaultValues:{payment_method:"",notes:""},resolver:(0,m.F)(z)}),{mutate:D}=(0,u.D)({mutationFn:e=>h(e),onSuccess:e=>{(null==e?void 0:e.status)===200&&_(!0)},onError:e=>{var t,s;let l=p("Unexpected-Error");if(null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)l=e.response.data.message;else if(e.message)try{let t=JSON.parse(e.message);(null==t?void 0:t.message)&&(l=t.message)}catch(e){l=e.message}S({title:p("Sending-Error"),description:l,variant:"destructive"})}}),T=async e=>{if(!b){S({title:p("select-address"),variant:"destructive"});return}D({...e,address_id:b.toString(),payment_method:y,notes:e.notes||""})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-y-3  ",children:[(0,l.jsx)("div",{className:"w-full md:w-7/12",children:(0,l.jsx)(a.l0,{...C,children:(0,l.jsx)("form",{onSubmit:e=>{e.preventDefault(),C.handleSubmit(T)()},children:(0,l.jsxs)("div",{className:" flex flex-col gap-y-[20px]",children:[(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:" flex items-center justify-between ",children:[(0,l.jsxs)("h2",{className:" md:text-[20px] text-[14px] font-bold text-text-main",children:[" ",p("deliveryLocation")]}),(0,l.jsx)(k,{locations:t,setAddressId:g})]})}),(0,l.jsx)("div",{children:(0,l.jsx)("div",{className:"",children:(0,l.jsxs)("h2",{className:"text-[20px] font-bold text-text-main",children:[" ",p("additionalInfo")]})})}),(0,l.jsx)("div",{children:(0,l.jsx)(a.Wi,{name:"notes",control:C.control,render:e=>{let{field:t}=e;return(0,l.jsxs)(a.xJ,{children:[(0,l.jsxs)(n._,{children:[" ",p("orderNotes")," "]}),(0,l.jsx)(r.g,{...t,placeholder:p("orderNotesPlaceholder")}),(0,l.jsx)(a.zG,{})]})}})})]})})})}),(0,l.jsx)("div",{className:"w-full md:w-4/12",children:(0,l.jsx)(v,{selectedMethod:y,setSelectedMethod:N,onSubmit:C.handleSubmit(T),cartData:s})})]}),(0,l.jsx)(F,{open:w,onOpenChange:_})]})}},23675:function(e,t,s){"use strict";s.d(t,{g:function(){return r}});var l=s(57437),a=s(2265),n=s(91001);let r=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)("textarea",{className:(0,n.cn)("flex min-h-[100px] w-full rounded-md border border-neutral-200 bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-neutral-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-neutral-950 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm dark:border-neutral-800 dark:placeholder:text-neutral-400 dark:focus-visible:ring-neutral-300",s),ref:t,...a})});r.displayName="Textarea"},8878:function(e,t,s){"use strict";s.d(t,{jD:function(){return d},rU:function(){return r},tv:function(){return o}});var l=s(87366),a=s(53795);let n=(0,l.R)({locales:["en","ar"],defaultLocale:"ar"}),{Link:r,redirect:i,usePathname:d,useRouter:o,getPathname:c}=(0,a.os)(n)},17384:function(e,t,s){"use strict";s.d(t,{r0:function(){return a},tV:function(){return n},xo:function(){return r}}),s(83079);var l=s(12119),a=(0,l.$)("cbb9e07356deb367d5e0653c08d3f9d87518a4d7"),n=(0,l.$)("71ca48030817e76cf8f571cac4fb72933f55127d"),r=(0,l.$)("be73ded0bd69d98a071e8134311d94936ff449d4")}},function(e){e.O(0,[1910,2972,5569,7529,1262,3080,6187,7423,3999,6663,6593,7116,820,1187,7239,431,2971,2117,1744],function(){return e(e.s=87686)}),_N_E=e.O()}]);